<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Authentication - CampusKart</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body class="auth-body">
    <div class="auth-main-content">
      <div id="loadingScreen" class="loading-screen hidden">
        <div class="loading-container">
          <div class="animated-logo">
            <div class="logo-shape"></div>
            <div class="logo-text">CampusKart</div>
          </div>
          <div class="loading-text">Authenticating...</div>
        </div>
      </div>

      <div class="auth-particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
      </div>

      <div class="auth-container">
        <div class="auth-card glass-card">
          <div class="auth-header">
            <div class="brand-logo">CK</div>
            <h1 class="auth-title">CampusKart Login</h1>
            <p class="auth-subtitle">Please use your Thapar University email</p>
          </div>

          <div class="auth-form-container active" style="padding-top: 20px">
            <button
              type="button"
              class="btn btn--primary btn--full-width google-btn"
              id="googleThaparLoginBtn"
            >
              <span class="btn-text">
                <span class="google-icon">üîç</span>
                Login through Thapar email
              </span>
              <span class="btn-loader hidden">üîÑ</span>
            </button>
            <p
              style="
                text-align: center;
                font-size: 12px;
                opacity: 0.7;
                margin-top: 20px;
              "
            >
              You must use your @thapar.edu email address.
            </p>
          </div>

          <div
            class="terms-agreement"
            style="
              text-align: center;
              font-size: 12px;
              padding: 20px;
              opacity: 0.8;
            "
          >
            By logging in, you agree to the
            <a href="#" class="terms-link" id="openTermsLink"
              >Terms of Service</a
            >
            and
            <a href="#" class="terms-link" id="openPrivacyLink"
              >Privacy Policy</a
            >.
          </div>
        </div>

        <div class="auth-footer">
          <p class="footer-text">
            Secure authentication powered by Firebase üîí
          </p>
        </div>
      </div>
    </div>
    <div class="message-container" id="messageContainer"></div>

    <div class="modal hidden" id="termsModal">
      <div class="modal-overlay"></div>
      <div class="modal-content glass-card">
        </div>
    </div>

    <div class="modal hidden" id="privacyModal">
      <div class="modal-overlay"></div>
      <div class="modal-content glass-card">
        </div>
    </div>

    <div class="modal hidden" id="completeProfileModal">
      <div class="modal-overlay" style="pointer-events: none"></div>
      <div class="modal-content glass-card">
        <div class="modal-header">
          <h3 class="modal-title">Complete Your Profile</h3>
          <p class="modal-message">
            Just one last step! We need your phone and hostel to finish your
            setup.
          </p>
        </div>
        <div class="modal-body">
          <form id="completeProfileForm">
            <div class="form-group">
              <label class="form-label">Phone Number</label>
              <input
                type="tel"
                id="modalPhoneNumber"
                class="form-control animated-input"
                placeholder="Enter your phone number"
                required
              />
            </div>
            <div class="form-group">
              <label class="form-label">Hostel Name</label>
              <select
                id="modalHostelName"
                class="form-control animated-input"
                required
              >
                <option value="">Select your hostel</option>
                <option value="A">A</option>
                <option value="B">B</option>
                <option value="C">C</option>
                <option value="D">D</option>
                <option value="H">H</option>
                <option value="J">J</option>
                <option value="K">K</option>
                <option value="L">L</option>
                <option value="M">M</option>
                <option value="O">O</option>
                <option value="E">E</option>
                <option value="G">G</option>
                <option value="I">I</option>
                <option value="N">N</option>
                <option value="HOTEL-PG">HOTEL-PG</option>
                <option value="Q">Q</option>
                <option value="FRF">FRF</option>
                <option value="FRG">FRG</option>
              </select>
            </div>
          </form>
        </div>
        <div class="modal-actions">
          <button
            class="btn btn--primary btn--full-width animated-btn"
            id="saveProfileCompletion"
          >
            <span class="btn-text">Save & Continue</span>
            <span class="btn-loader hidden">üîÑ</span>
          </button>
        </div>
      </div>
    </div>

    <script type="module">
      // Import Firebase modules using the same version as index.html
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
      import {
        getAuth,
        createUserWithEmailAndPassword,
        signInWithEmailAndPassword,
        signInWithPopup,
        GoogleAuthProvider,
        sendPasswordResetEmail,
        updateProfile,
        onAuthStateChanged,
        signOut,
      } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
      import {
        getFirestore,
        doc,
        setDoc,
        getDoc,
        collection,
        addDoc,
      } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

      // Firebase configuration from your existing setup
      const firebaseConfig = {
        apiKey: "AIzaSyBrVVik7_oVaPXpyI20jcyq9nqXUKcwcOM",
        authDomain: "thrift-6bd6d.firebaseapp.com",
        projectId: "thrift-6bd6d",
        storageBucket: "thrift-6bd6d.firebasestorage.app",
        messagingSenderId: "595724600327",
        appId: "1:595724600327:web:e1a9d65d6e6ee68e0456a2",
        measurementId: "G-7PGCTDYP38",
      };

      // Initialize Firebase with error handling
      try {
        console.log("üî• Initializing Firebase...");
        const app = initializeApp(firebaseConfig);
        console.log("‚úÖ Firebase app initialized:", app);

        const auth = getAuth(app);
        console.log("‚úÖ Auth initialized:", auth);

        const db = getFirestore(app);
        console.log("‚úÖ Firestore initialized:", db);

        // Configure Google Provider with proper scopes
        const googleProvider = new GoogleAuthProvider();
        googleProvider.addScope("email");
        googleProvider.addScope("profile");
        googleProvider.setCustomParameters({
          prompt: "select_account",
          hd: "thapar.edu",
        });
        console.log("‚úÖ Google provider configured:", googleProvider);

        // Make Firebase services available globally
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.googleProvider = googleProvider;
        window.firebaseModules = {
          createUserWithEmailAndPassword,
          signInWithEmailAndPassword,
          signInWithPopup,
          sendPasswordResetEmail,
          updateProfile,
          onAuthStateChanged,
          signOut,
          doc,
          setDoc,
          getDoc,
          collection,
          addDoc,
        };

        console.log("‚úÖ Firebase setup complete!");

        // Signal that Firebase is ready
        window.firebaseReady = true;
        window.dispatchEvent(new CustomEvent("firebaseReady"));
      } catch (error) {
        console.error("‚ùå Firebase initialization failed:", error);
        window.firebaseError = error;
      }
    </script>

    <script src="auth.js"></script>

    <script src="theme.js" defer></script>
  </body>
</html>