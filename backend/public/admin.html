<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>CampusKart ‚Äî Admin Review</title>
    <link rel="icon" type="image/svg" href="logoCart.png">
    <link rel="stylesheet" href="style.css" />
    <style>
      /* --- FORCE DARK THEME FOR ADMIN PAGE --- */
      body { 
        background-color: #0a192f !important; 
        color: #ffffff !important; 
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; 
      }
      
      /* Fix for the dropdown menu options being unreadable */
      select option {
        background-color: #ffffff;
        color: #000000;
      }
      
      /* Ensure links/inputs don't get overridden */
      .admin-container { color: #ffffff !important; }
      body { background-color: #0a192f; color: #ffffff; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; }
      .admin-container { max-width:1100px;margin:36px auto;padding:20px; color: #ffffff;}
      .item-row{display:flex;gap:12px;align-items:flex-start;padding:16px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.05);border-radius:8px;margin-bottom:12px}
      .item-info{flex:1}
      .item-thumb{width:120px;height:120px;object-fit:cover;border-radius:6px}
      .item-meta{flex:1;color: #cbd5e1;}
      .item-meta strong{color: #ffffff;display:block;margin-bottom:4px;}
      .item-meta div{margin:4px 0;font-size:14px;}
      .item-title{font-size:18px;font-weight:500;margin:0 0 4px;color: #ffffff;}
      .item-description{margin:8px 0;font-size:15px;color: #cbd5e1;}
      .item-price{font-weight:500;color: #64ffda;}
      h1 { color: #ffffff; margin-bottom: 24px; font-size: 32px; }
      h3 { color: #ffffff; margin: 32px 0 16px; font-size: 20px; }
      .sign-out-btn { 
        background: #ff4757;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        margin-top: 20px;
      }
      .sign-out-btn:hover {
        background: #ff6b81;
      }
      #notAdmin {
        text-align: center;
        padding: 40px;
        background: rgba(255,255,255,0.05);
        border-radius: 8px;
        margin-top: 20px;
      }
      .admin-actions{display:flex;gap:8px;flex-direction:column;min-width:150px;}
      .btn{padding:8px 16px;border-radius:6px;border:none;cursor:pointer;font-size:14px;transition:all 0.2s;}
      .btn--primary{background:#4CAF50;color:white;}
      .btn--primary:hover{background:#45a049;}
      .btn--danger{background:#F44336;color:white;}
      .btn--danger:hover{background:#da190b;}
      .hidden{display:none;}
      .user-lookup-section{margin-top:32px;padding:20px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;}
      .lookup-controls{display:flex;gap:12px;margin-bottom:16px;}
      #lookupUid{flex:1;padding:8px 12px;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.2);border-radius:4px;color:#ffffff;font-size:14px;}
      #lookupBtn{padding:8px 16px;background:#00e5ff;color:#0a192f;border:none;border-radius:4px;cursor:pointer;font-weight:500;}
      #lookupBtn:hover{background:#00b8d4;}
      #userPanel{margin-top:16px;padding:16px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.1);border-radius:6px;}
      #userPanel input{padding:6px 10px;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.2);border-radius:4px;color:#ffffff;margin-left:8px;}
      #userPanel label{color:#cbd5e1;font-size:14px;}
      .empty-state{text-align:center;padding:40px;color:#8892b0;}
      .admin-tabs{display:flex;flex-wrap: wrap;gap:8px;margin:20px 0;border-bottom:2px solid rgba(255,255,255,0.1);}
      .admin-tab{background:none;border:none;color:#8892b0;padding:12px 20px;cursor:pointer;font-size:15px;border-bottom:3px solid transparent;transition:all 0.2s;}
      .admin-tab:hover{color:#ffffff;background:rgba(255,255,255,0.05);}
      .admin-tab.active{color:#00e5ff;border-bottom-color:#00e5ff;}
      .tab-content{display:none;}
      .tab-content.active{display:block;}
      .tab-content h2{color:#ffffff;font-size:20px;margin:24px 0 16px;}
      .user-card{padding:16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;margin-bottom:12px;}
      .user-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;}
      .user-name{font-size:16px;font-weight:500;color:#ffffff;}
      .user-email{color:#8892b0;font-size:14px;}
      .user-badges{display:flex;gap:6px;margin-top:8px;}
      .badge{padding:4px 8px;border-radius:4px;font-size:12px;font-weight:500;}
      .badge-admin{background:#8b5fff;color:#ffffff;}
      .badge-banned{background:#ff4757;color:#ffffff;}
      .badge-strikes{background:#ffa502;color:#ffffff;}
      .user-actions{display:flex;gap:8px;margin-top:12px;}
      .user-stats{display:flex;gap:24px;padding:16px;background:rgba(0,229,255,0.1);border:1px solid rgba(0,229,255,0.2);border-radius:8px;margin-bottom:20px;color:#cbd5e1;}
      .user-stats strong{color:#00e5ff;}
      .marketplace-item{display:flex;gap:12px;padding:16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;margin-bottom:12px;}
      .marketplace-item-image{width:100px;height:100px;object-fit:cover;border-radius:6px;}
      .marketplace-item-info{flex:1;}
      .marketplace-item-title{font-size:16px;font-weight:500;color:#ffffff;margin-bottom:4px;}
      .marketplace-item-price{color:#00ff88;font-weight:500;font-size:14px;}
      .marketplace-item-seller{color:#8892b0;font-size:13px;margin-top:4px;}
      
      /* --- NEW NOTIFICATION FORM STYLES --- */
      .notification-form {
        display: flex;
        flex-direction: column;
        gap: 16px;
        max-width: 600px;
      }
      #notificationMessage {
        min-height: 150px;
        padding: 12px;
        background: rgba(255,255,255,0.08);
        border: 1px solid rgba(255,255,255,0.2);
        border-radius: 6px;
        color: #ffffff;
        font-size: 15px;
        font-family: inherit;
      }
      #postNotificationBtn {
        align-self: flex-start;
        background-color: #00e5ff;
        color: #0a192f;
        font-weight: 500;

      /* Analytics Styles */
      .analytics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
      }
      .stat-card {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        padding: 20px;
        display: flex;
        align-items: center;
        gap: 16px;
      }
      .stat-icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
      }
      .stat-info h3 { margin: 0; font-size: 14px; color: #8892b0; font-weight: normal; }
      .stat-info p { margin: 4px 0 0; font-size: 24px; font-weight: 600; color: #ffffff; }
      
      .time-filter-btn {
        background: transparent;
        border: none;
        color: #8892b0;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 13px;
        transition: all 0.2s;
      }
      .time-filter-btn:hover { color: #ffffff; background: rgba(255,255,255,0.1); }
      .time-filter-btn.active { background: #00e5ff; color: #0a192f; font-weight: 600; }
      }
    </style>
  </head>
  <body>
    <div class="admin-container">
      <div id="content" style="display: none;">
        <h1>Admin Dashboard</h1>
        
        <div class="admin-tabs">
          <button class="admin-tab active" data-tab="pending">Pending Items</button>
          <button class="admin-tab" data-tab="flagged">Flagged Items</button>
          <button class="admin-tab" data-tab="marketplace">Marketplace Posts</button>
          <button class="admin-tab" data-tab="users">All Users</button>
          <button class="admin-tab" data-tab="notifications">Post Notification</button>
          <button class="admin-tab" data-tab="analytics">Analytics Dashboard</button>
        </div>

        <div id="pendingSection" class="tab-content active">
          <h2>Pending Approval</h2>
          <div id="itemsList"></div>
        </div>

        <div id="flaggedSection" class="tab-content">
          <h2>Reported / Flagged Items</h2>
          <div id="flaggedItemsList"></div>
        </div>

        <div id="marketplaceSection" class="tab-content">
          <h2>All Marketplace Posts</h2>
          
          <input 
            type="text" 
            id="marketplaceSearchInput" 
            placeholder="Search by title, seller ID, or description..." 
            style="width: 100%; padding: 8px 12px; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.2); border-radius: 4px; color: #ffffff; font-size: 14px; margin-bottom: 20px;">

          <div id="marketplaceList"></div>
        </div>

        <div id="usersSection" class="tab-content">
          <h2>All Users</h2>
          <div class="user-stats">
            <div>Total Users: <strong id="totalUsers">0</strong></div>
            <div>Banned: <strong id="bannedUsers">0</strong></div>
            <div>Admins: <strong id="adminUsers">0</strong></div>
          </div>

          <!-- Search and Filter Controls -->
          <div style="display: flex; gap: 10px; margin-bottom: 20px;">
            <input 
              type="text" 
              id="userSearchInput" 
              placeholder="Search by email or UID..." 
              style="flex: 1; padding: 8px 12px; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.2); border-radius: 4px; color: #ffffff; font-size: 14px;">
            
            <select id="userHostelFilter" style="width: 150px; padding: 8px 12px; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.2); border-radius: 4px; color: #ffffff; font-size: 14px;">
              <option value="">All Hostels</option>
              <option value="A">Hostel A</option>
              <option value="B">Hostel B</option>
              <option value="C">Hostel C</option>
              <option value="D">Hostel D</option>
              <option value="E">Hostel E</option>
              <option value="G">Hostel G</option>
              <option value="H">Hostel H</option>
              <option value="I">Hostel I</option>
              <option value="J">Hostel J</option>
              <option value="K">Hostel K</option>
              <option value="L">Hostel L</option>
              <option value="M">Hostel M</option>
              <option value="N">Hostel N</option>
              <option value="O">Hostel O</option>
              <option value="Q">Hostel Q</option>
              <option value="HOSTEL-PG">HOSTEL-PG</option>
              <option value="Day Scholar">Day Scholar</option>
              <option value="FRF">FRF</option>
              <option value="FRG">FRG</option>
            </select>
          </div>
          <div id="usersList"></div>
        </div>

        <div id="notificationsSection" class="tab-content">
          <h2>Post a New Notification</h2>
          <p style="color: #8892b0; max-width: 600px; margin-bottom: 16px;">
            This will be sent to all users and appear in their profile's notification tab.
          </p>
          <div class="notification-form">
            <textarea id="notificationMessage" placeholder="Type your message... (e.g., 'Scheduled maintenance tomorrow from 2-3 AM.')"></textarea>
            <button id="postNotificationBtn" class="btn btn--primary" style="background-color: #00e5ff; color: #0a192f; font-weight: 500;">
              Post Notification
            </button>
          </div>
        </div>

        <div id="analyticsSection" class="tab-content">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
            <h2>Platform Analytics</h2>
            
            <div class="filter-controls" style="display: flex; gap: 8px; background: rgba(255,255,255,0.05); padding: 4px; border-radius: 8px;">
              <button class="time-filter-btn active" onclick="updateAnalytics('week')">7 Days</button>
              <button class="time-filter-btn" onclick="updateAnalytics('month')">30 Days</button>
              <button class="time-filter-btn" onclick="updateAnalytics('year')">All Time</button>
            </div>
          </div>

          <div class="analytics-grid">
            <div class="stat-card">
              <div class="stat-icon" style="background: rgba(0, 229, 255, 0.1); color: #00e5ff;">üì¶</div>
              <div class="stat-info">
                <h3>Total Posted</h3>
                <p id="statPosted">0</p>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon" style="background: rgba(0, 255, 136, 0.1); color: #00ff88;">üí∞</div>
              <div class="stat-info">
                <h3>Items Sold</h3>
                <p id="statSold">0</p>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon" style="background: rgba(255, 165, 2, 0.1); color: #ffa502;">üí∏</div>
              <div class="stat-info">
                <h3>Est. Volume</h3>
                <p id="statVolume">‚Çπ0</p>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon" style="background: rgba(255, 84, 89, 0.1); color: #ff5459;">üóëÔ∏è</div>
              <div class="stat-info">
                <h3>Deleted/Banned</h3>
                <p id="statDeleted">0</p>
              </div>
            </div>
          </div>

          <div class="chart-container-wrapper glass-card" style="margin-top: 24px; padding: 20px; background: rgba(255,255,255,0.03); border-radius: 12px;">
            <canvas id="mainChart"></canvas>
          </div>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-top: 24px;">
             <div class="chart-container-wrapper glass-card" style="padding: 20px; background: rgba(255,255,255,0.03); border-radius: 12px;">
                <h4 style="margin-bottom: 15px; color: #cbd5e1;">Category Distribution</h4>
                <canvas id="categoryChart"></canvas>
             </div>
             <div class="chart-container-wrapper glass-card" style="padding: 20px; background: rgba(255,255,255,0.03); border-radius: 12px;">
                <h4 style="margin-bottom: 15px; color: #cbd5e1;">Hostel Activity</h4>
                <canvas id="hostelChart"></canvas>
             </div>
          </div>
        </div>
        
        <button id="signOutBtn" class="sign-out-btn">Sign Out</button>
      </div>
      <div id="notAdmin" style="display:none">
        <h1>Access Denied</h1>
        <p>You must be an admin to view this page.</p>
        <button id="signOutBtn" class="sign-out-btn">Sign Out</button>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module" src="admin.js"></script>
  </body>
</html>